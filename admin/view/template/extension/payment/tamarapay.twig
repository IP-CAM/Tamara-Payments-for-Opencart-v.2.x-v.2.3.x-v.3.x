{{ header }}{{ column_left }}
<div id="content">
    <div class="page-header">
        <div class="container-fluid">
            <div class="pull-right">
                <button type="submit" form="form-payment" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
                <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a></div>
            <h1>{{ heading_title }}</h1>
            <ul class="breadcrumb">
                {% for breadcrumb in breadcrumbs %}
                    <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="container-fluid">
        {% if error_warning %}
            <div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
            </div>
            <div class="panel-body">
                <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-payment" class="form-horizontal">

                    <div class="panel-group" id="tamara-payment-api-configurations">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title"><a href="#collapse-api-configurations" data-toggle="collapse" data-parent="#tamara-payment-api-configurations" class="accordion-toggle collapsed" aria-expanded="false">API Configurations <i class="fa fa-caret-down"></i></a></h4>
                            </div>
                            <div class="panel-collapse collapse" id="collapse-api-configurations" aria-expanded="false" style="height: 0px;">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-sm-12">

                                            <div class="form-group required">
                                                <label class="col-sm-2 control-label" for="input-url">{{ entry_url }}</label>
                                                <div class="col-sm-10">
                                                    <input type="text" name="payment_tamarapay_url" value="{{ payment_tamarapay_url }}" placeholder="{{ entry_url }}" id="input-url" class="form-control"/>
                                                    {% if error_url %}
                                                        <div class="text-danger">{{ error_url }}</div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="form-group required">
                                                <label class="col-sm-2 control-label" for="input-token">{{ entry_token }}</label>
                                                <div class="col-sm-10">
                                                    <textarea class="form-control" id="input-token" placeholder="{{ entry_token }}" rows="7" name="payment_tamarapay_token">{{ payment_tamarapay_token }}</textarea>
                                                    {% if error_token %}
                                                        <div class="text-danger">{{ error_token }}</div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="form-group required">
                                                <label class="col-sm-2 control-label" for="input-token-notification">{{ entry_token_notification }}</label>
                                                <div class="col-sm-10">
                                                    <textarea class="form-control" id="input-token-notification" placeholder="{{ entry_token_notification }}" rows="7" name="payment_tamarapay_token_notification">{{ payment_tamarapay_token_notification }}</textarea>
                                                    {% if error_token_notification %}
                                                        <div class="text-danger">{{ error_token_notification }}</div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label" for="input-trigger-actions-enabled">{{ entry_enable_trigger_actions }}</label>
                                                <div class="col-sm-10">
                                                    <select name="payment_tamarapay_trigger_actions_enabled" id="input-trigger-actions-enabled" class="form-control">
                                                        {% if payment_tamarapay_trigger_actions_enabled %}
                                                            <option value="1" selected="selected">{{ text_enabled }}</option>
                                                            <option value="0">{{ text_disabled }}</option>
                                                        {% else %}
                                                            <option value="1">{{ text_enabled }}</option>
                                                            <option value="0" selected="selected">{{ text_disabled }}</option>
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label" for="input-iframe-checkout-enabled">{{ entry_enable_iframe_checkout }}</label>
                                                <div class="col-sm-10">
                                                    <select name="payment_tamarapay_iframe_checkout_enabled" id="input-iframe-checkout-enabled" class="form-control">
                                                        {% if payment_tamarapay_iframe_checkout_enabled %}
                                                            <option value="1" selected="selected">{{ text_enabled }}</option>
                                                            <option value="0">{{ text_disabled }}</option>
                                                        {% else %}
                                                            <option value="1">{{ text_enabled }}</option>
                                                            <option value="0" selected="selected">{{ text_disabled }}</option>
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel-group" id="tamara-payment-types">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title"><a href="#collapse-payment-types" data-toggle="collapse" data-parent="#tamara-payment-types" class="accordion-toggle collapsed" aria-expanded="false">Payment types <i class="fa fa-caret-down"></i></a></h4>
                            </div>
                            <div class="panel-collapse collapse" id="collapse-payment-types" aria-expanded="false" style="height: 0px;">
                                <div class="panel-body">


                                    <div class="panel-group" id="pay-by-later-group">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <h4 class="panel-title"><a href="#collapse-pay-by-later" data-toggle="collapse" data-parent="#pay-by-later-group" class="accordion-toggle" aria-expanded="true">Pay later in 30 days <i class="fa fa-caret-down"></i></a></h4>
                                            </div>
                                            <div class="panel-collapse collapse in" id="collapse-pay-by-later" aria-expanded="true">
                                                <div class="panel-body">
                                                    <div class="row">

                                                        <div class="row form-group required">
                                                            <label class="col-sm-4 control-label" for="pay-by-later-enabled">{{ entry_enable }}</label>
                                                            <div class="col-sm-8">

                                                                <select name="payment_tamarapay_types_pay_by_later_enabled" id="pay-by-later-enabled" class="form-control">
                                                                    {% if payment_tamarapay_types_pay_by_later_enabled %}
                                                                        <option value="1" selected="selected">{{ text_enabled }}</option>
                                                                        <option value="0">{{ text_disabled }}</option>
                                                                    {% else %}
                                                                        <option value="1">{{ text_enabled }}</option>
                                                                        <option value="0" selected="selected">{{ text_disabled }}</option>
                                                                    {% endif %}
                                                                </select>

                                                            </div>
                                                        </div>
                                                        <div class="row form-group">
                                                            <label class="col-sm-4 control-label" for="input-url">{{ entry_min_limit_amount }}</label>
                                                            <div class="col-sm-8">
                                                                <input type="text" id="payment_tamarapay_types_pay_by_later_min_limit" name="payment_tamarapay_types_pay_by_later_min_limit" value="{{ payment_tamarapay_types_pay_by_later_min_limit }}" placeholder="{{ entry_min_limit_amount }}" class="form-control" readonly/>
                                                            </div>
                                                        </div>
                                                        <div class="row form-group">
                                                            <label class="col-sm-4 control-label" for="input-url">{{ entry_max_limit_amount }}</label>
                                                            <div class="col-sm-8">
                                                                <input type="text" id="payment_tamarapay_types_pay_by_later_max_limit" name="payment_tamarapay_types_pay_by_later_max_limit" value="{{ payment_tamarapay_types_pay_by_later_max_limit }}" placeholder="{{ entry_max_limit_amount }}" class="form-control" readonly/>
                                                                <input type="hidden" id="payment_tamarapay_types_pay_by_later_currency" name="payment_tamarapay_types_pay_by_later_currency" value="{{ payment_tamarapay_types_pay_by_later_currency }}" />
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="panel-group" id="pay-by-instalments-group">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <h4 class="panel-title"><a href="#collapse-pay-by-instalments" data-toggle="collapse" data-parent="#pay-by-instalments-group" class="accordion-toggle" aria-expanded="true">Pay in 3 instalments <i class="fa fa-caret-down"></i></a></h4>
                                            </div>
                                            <div class="panel-collapse collapse in" id="collapse-pay-by-instalments" aria-expanded="true">
                                                <div class="panel-body">
                                                    <div class="row">

                                                        <div class="row form-group required">
                                                            <label class="col-sm-4 control-label" for="pay-by-instalments-enabled">{{ entry_enable }}</label>
                                                            <div class="col-sm-8">

                                                                <select name="payment_tamarapay_types_pay_by_instalments_enabled" id="pay-by-instalments-enabled" class="form-control">
                                                                    {% if payment_tamarapay_types_pay_by_instalments_enabled %}
                                                                        <option value="1" selected="selected">{{ text_enabled }}</option>
                                                                        <option value="0">{{ text_disabled }}</option>
                                                                    {% else %}
                                                                        <option value="1">{{ text_enabled }}</option>
                                                                        <option value="0" selected="selected">{{ text_disabled }}</option>
                                                                    {% endif %}
                                                                </select>

                                                            </div>
                                                        </div>
                                                        <div class="row form-group">
                                                            <label class="col-sm-4 control-label" for="input-url">{{ entry_min_limit_amount }}</label>
                                                            <div class="col-sm-8">
                                                                <input type="text" id="payment_tamarapay_types_pay_by_instalments_min_limit" name="payment_tamarapay_types_pay_by_instalments_min_limit" value="{{ payment_tamarapay_types_pay_by_instalments_min_limit }}" placeholder="{{ entry_min_limit_amount }}" class="form-control" readonly />
                                                            </div>
                                                        </div>
                                                        <div class="row form-group">
                                                            <label class="col-sm-4 control-label" for="input-url">{{ entry_max_limit_amount }}</label>
                                                            <div class="col-sm-8">
                                                                <input type="text" id="payment_tamarapay_types_pay_by_instalments_max_limit" name="payment_tamarapay_types_pay_by_instalments_max_limit" value="{{ payment_tamarapay_types_pay_by_instalments_max_limit }}" placeholder="{{ entry_max_limit_amount }}" class="form-control" readonly />
                                                                <input type="hidden" id="payment_tamarapay_types_pay_by_instalments_currency" name="payment_tamarapay_types_pay_by_instalments_currency" value="{{ payment_tamarapay_types_pay_by_instalments_currency }}" />
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="col-sm-12">
                                            <button type="button" id="update-payment-config">Update config</button>
                                            <span id="update-payment-config-message" style="display: none;"></span>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel-group" id="tamara-payment-order-statuses">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title"><a href="#collapse-order-statuses" data-toggle="collapse" data-parent="#tamara-payment-order-statuses" class="accordion-toggle collapsed" aria-expanded="false">Checkout order statuses <i class="fa fa-caret-down"></i></a></h4>
                            </div>
                            <div class="panel-collapse collapse" id="collapse-order-statuses" aria-expanded="false" style="height: 0px;">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-sm-12">




                                            <div class="form-group">
                                                <label class="col-sm-2 control-label" for="input-order-status-success">{{ entry_order_status_success }}</label>
                                                <div class="col-sm-10">
                                                    <select name="payment_tamarapay_order_status_success_id" id="input-order-status-success" class="form-control">
                                                        {% for order_status in order_statuses %}
                                                            {% if order_status.order_status_id == payment_tamarapay_order_status_success_id %}
                                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                                            {% else %}
                                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label" for="input-order-status-failure">{{ entry_order_status_failure }}</label>
                                                <div class="col-sm-10">
                                                    <select name="payment_tamarapay_order_status_failure_id" id="input-order-status-failure" class="form-control">
                                                        {% for order_status in order_statuses %}
                                                            {% if order_status.order_status_id == payment_tamarapay_order_status_failure_id %}
                                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                                            {% else %}
                                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label" for="input-order-status-canceled">{{ entry_order_status_canceled }}</label>
                                                <div class="col-sm-10">
                                                    <select name="payment_tamarapay_order_status_canceled_id" id="input-order-status-canceled" class="form-control">
                                                        {% for order_status in order_statuses %}
                                                            {% if order_status.order_status_id == payment_tamarapay_order_status_canceled_id %}
                                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                                            {% else %}
                                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label" for="input-order-status-authorised">{{ entry_order_status_authorised }}</label>
                                                <div class="col-sm-10">
                                                    <select name="payment_tamarapay_order_status_authorised_id" id="input-order-status-authorised" class="form-control">
                                                        {% for order_status in order_statuses %}
                                                            {% if order_status.order_status_id == payment_tamarapay_order_status_authorised_id %}
                                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                                            {% else %}
                                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel-group" id="tamara-payment-capture-order-statuses">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title"><a href="#collapse-capture-order-statuses" data-toggle="collapse" data-parent="#tamara-payment-capture-order-statuses" class="accordion-toggle collapsed" aria-expanded="false">Capture payment <i class="fa fa-caret-down"></i></a></h4>
                            </div>
                            <div class="panel-collapse collapse" id="collapse-capture-order-statuses" aria-expanded="false" style="height: 0px;">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label class="col-sm-6 control-label" for="input-capture-order-status">{{ entry_capture_order_status }}</label>
                                                <div class="col-sm-6">
                                                    <select name="payment_tamarapay_capture_order_status_id" id="input-capture-order-status" class="form-control">
                                                        {% for order_status in order_statuses %}
                                                            {% if order_status.order_status_id == payment_tamarapay_capture_order_status_id %}
                                                                <option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
                                                            {% else %}
                                                                <option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel-group" id="tamara-payment-general-configuration">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">General configuration</h4>
                            </div>
                            <div class="panel-body">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-debug-enabled">{{ entry_enable_debug }}</label>
                                    <div class="col-sm-10">
                                        <select name="payment_tamarapay_debug" id="input-debug-enabled" class="form-control">
                                            {% if payment_tamarapay_debug %}
                                                <option value="1" selected="selected">{{ text_enabled }}</option>
                                                <option value="0">{{ text_disabled }}</option>
                                            {% else %}
                                                <option value="1">{{ text_enabled }}</option>
                                                <option value="0" selected="selected">{{ text_disabled }}</option>
                                            {% endif %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-geo-zone">{{ entry_geo_zone }}</label>
                                    <div class="col-sm-10">
                                        <select name="payment_tamarapay_geo_zone_id" id="input-geo-zone" class="form-control">
                                            <option value="0">{{ text_all_zones }}</option>
                                            {% for geo_zone in geo_zones %}
                                                {% if geo_zone.geo_zone_id == payment_tamarapay_geo_zone_id %}
                                                    <option value="{{ geo_zone.geo_zone_id }}" selected="selected">{{ geo_zone.name }}</option>
                                                {% else %}
                                                    <option value="{{ geo_zone.geo_zone_id }}">{{ geo_zone.name }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-status">{{ entry_status }}</label>
                                    <div class="col-sm-10">
                                        <select name="payment_tamarapay_status" id="input-status" class="form-control">
                                            {% if payment_tamarapay_status %}
                                                <option value="1" selected="selected">{{ text_enabled }}</option>
                                                <option value="0">{{ text_disabled }}</option>
                                            {% else %}
                                                <option value="1">{{ text_enabled }}</option>
                                                <option value="0" selected="selected">{{ text_disabled }}</option>
                                            {% endif %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-sort-order">{{ entry_sort_order }}</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="payment_tamarapay_sort_order" value="{{ payment_tamarapay_sort_order }}" placeholder="{{ entry_sort_order }}" id="input-sort-order" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript"><!--
    $('.date').datetimepicker({
        language: '{{ datepicker }}',
        pickTime: false
    });

    $('#update-payment-config').on('click', function() {
        $.ajax({
            url: 'index.php?route=extension/payment/tamarapay/retrievePaymentConfig&user_token={{ user_token }}',
            type: 'get',
            contentType: "application/json",
            dataType: 'json',
            data: {},
            beforeSend: function() {
                $('#update-payment-config').attr("disabled", true);
            },
            complete: function() {
                $('#update-payment-config').attr("disabled", false);
            },
            success: function(rs) {
                if (rs.success == true) {
                    let paymentTypes = rs.payment_types;
                    for (let i = 0; i < paymentTypes.length; i++) {
                        let name = paymentTypes[i].name.toLowerCase();
                        let elementMinLimit = '#payment_tamarapay_types_' + name  + '_min_limit';
                        $(elementMinLimit).val(paymentTypes[i].min_limit.amount);
                        let elementMaxLimit = '#payment_tamarapay_types_' + name  + '_max_limit';
                        $(elementMaxLimit).val(paymentTypes[i].max_limit.amount);
                        let elementCurrency = '#payment_tamarapay_types_' + name  + '_currency';
                        $(elementCurrency).val(paymentTypes[i].max_limit.currency);
                        $('#update-payment-config-message').text("Update config successful").addClass("text-success").show();
                    }
                } else {
                    $('#update-payment-config-message').text("Update config failed, please check log file").addClass("text-danger").show();
                }

                $('#update-payment-config').attr("disabled", false);
            }
        });
    });
//--></script>
{{ footer }}